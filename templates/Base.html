<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>{% block title %}{% endblock %}</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='global.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='attackbutton.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='tutorialbutton.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='attackoverlay.css') }}">
</head>

<body>
  <div class="layout-grid">
    <header>
      {% block header %}
      <div class="header-title">
        {% if current_user %}
        <h1><a href="{{ url_for('homepage') }}">Critical Job Bank </a></h1>
        {% else %}
        <h1><a href="{{ url_for('splash') }}">Critical Job Bank </a></h1>
        {% endif %}
      </div>

      <div class="header-account">
        <div class="header-account-link">
          {% if current_user %}
          Kia Ora, {{ current_user }}
        </div>
        <div class="header-dropdown">
          <a href="{{ url_for('settings') }}">⚙ Settings</a>
          <a href="{{ url_for('login_bp.logout') }}">꩜ Logout</a>
        </div>
        {% else %}
          <a href="{{ url_for('login_bp.login') }}">꩜ Login</a>
        {% endif %}
      </div>
      {% endblock %}
    </header>

    <nav class="sidebar">
      {% block sidebar %}
      <ul>

        {% if current_user %}
            <!-- LOGGED-IN SIDEBAR -->
            <li><a href="{{ url_for('my_accounts') }}">My Accounts</a></li>
            <li><a href="{{ url_for('my_cards') }}">My Cards</a></li>
            <li><a href="{{ url_for('transfer_bp.transfer_funds_page') }}">Transfer Funds</a></li>
            <li><a href="{{ url_for('my_insurance') }}">My Insurance</a></li>
            <li><a href="{{ url_for('attacks') }}">Attacks</a></li>
            <li><a href="#Tutorials" id="sidebarTutorials">Tutorials</a></li>

            <!-- These two exist in BOTH menus but must link to real pages when logged in -->
            <li><a href="{{ url_for('aboutus') }}">About Us</a></li>
            <li><a href="{{ url_for('help') }}">Help</a></li>

        {% else %}
            <!-- PUBLIC (NOT LOGGED IN) SIDEBAR -->
            <li><a href="{{ url_for('features') }}">Features</a></li>
            <li><a href="https://owasp.org/www-project-top-ten/" target="_blank">OWASP Top Ten</a></li>
            <li><a href="#dev">Secure Development Practices</a></li>
            <li><a href="#contact">Contact Us</a></li>

            <!-- About Us and Help exist but scroll anchors (public version) -->
            <li><a href="{{ url_for('aboutus') }}">About Us</a></li>
            <li><a href="#help">Help</a></li>

            <li><a href="https://github.com/NZShroomy/Vulnerable-Web-app" target="_blank">GitHub Repo</a></li>
        {% endif %}

    </ul>
      {% endblock %}
    </nav>

    <main>
      {% block content %}{% endblock %}
    </main>
  </div>

  <!-- attack buttons -->
  {% include "components/attack_buttons.html" %}
  {% include "components/attack_overlay.html" %}
  <script src="{{ url_for('static', filename='attackbutton.js') }}"></script>


  <!-- Tutorial Button -->
  {% include "components/tutorialbutton.html" %}
  <script src="{{ url_for('static', filename='tutorialbutton.js') }}"></script>



  <script>
    document.addEventListener("DOMContentLoaded", () => {
      // Dark mode
      if (localStorage.getItem('darkMode') === 'true') {
        document.body.classList.add('dark-mode');
      } else {
        document.body.classList.remove('dark-mode');
      }

      const savedFont = localStorage.getItem('fontSize');
      if (savedFont) document.body.style.fontSize = savedFont + 'px';
    });
  </script>
</body>

</html>